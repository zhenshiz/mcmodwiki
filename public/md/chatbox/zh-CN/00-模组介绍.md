<h1 id="模组介绍" data-toc-id="模组介绍">模组介绍</h1>
<p>这是一款类似于Gal的对话框，为整合包或者地图的作者们制作。可以使用数据包编写对话框的主题样式和对话文本内容，提供一些事件给KubeJS使用。</p>
<h2 id="指令" data-toc-id="指令">指令</h2>
<p>ChatBox添加自定义的指令，允许开发者使用指令来与mod交互。</p>
<ul>
  <li>
    <p>
      <code>/chatbox skip &lt;数据包路径: ResourceLocation&gt; &lt;组名: String&gt; &lt;序号: int&gt; &lt;目标实体: Target1 Target2 Target3 ...&gt;</code>
      跳转到指定的对话</p>
    <ul>
      <li>
        <p><strong>数据包路径</strong>：对话文本文件的位置</p>
      </li>
      <li>
        <p><strong>组名</strong>：对话文本文件内一段对话的标识符</p>
      </li>
      <li>
        <p><strong>序号</strong>（可选，默认为0）：一段对话中对话的序号</p>
      </li>
      <li>
        <p>
          <strong>目标实体</strong>（可选）：指定对话的目标实体，多个实体之间用空格隔开，用于在对话文本或指令中引用目标实体的属性（<strong>详见</strong><a
            href="?file=&quot;10-扩展功能.占位符.md&quot;"><strong>占位符</strong></a>）或进行交互。
        </p>
      </li>
    </ul>
  </li>
  <li>
    <p><code>/chatbox theme &lt;数据包路径: ResourceLocation&gt;</code> 切换对话框主题</p>
  </li>
  <li>
    <p><code>/chatbox open</code> 打开最近一次对话</p>
  </li>
  <li>
    <p>
      <code>/chatbox maxTriggerCount &lt;数据包路径: ResourceLocation&gt; &lt;最大访问次数:int&gt;</code>
      设置一段对话的最大访问次数</p>
    <ul>
      <li>
        <p><strong>最大访问次数</strong>：-1表示无限访问次数，0表示无法访问，非0则为设置最大访问次数</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code>/chatbox maxTriggerCount reset</code> 重置最大访问次数</p>
  </li>
  <li>
    <p><code>/chatbox command nextDialogue</code> 跳转下一句话</p>
  </li>
  <li>
    <p><code>/chatbox command autoPlay &lt;开关：Boolean&gt;</code> 开关自动对话</p>
  </li>
  <li>
    <p><code>/chatbox command isScreen &lt;开关：Boolean&gt;</code>
      true为屏幕主题模式，该模式有对话更有沉浸感可以用鼠标选择选项；false为渲染主题模式，该模式下玩家可以正常移动交互，通过鼠标和按键来交互对话框（可以通过主题配置阻止玩家自由跳转下一句对话，详见<a
        href="#按键提示">按键提示</a>）</p>
  </li>
</ul>
<h2 id="数据包路径" data-toc-id="数据包路径">数据包路径</h2>
<p>ChatBox 会自动加载对话框中对应路径下的json文件。</p>
<p>
  对话框主题的文件路径为<code>data/&lt;命名空间&gt;/chatbox/theme/&lt;文件名&gt;.json</code>，对话框文本的文件路径为<code>data/&lt;命名空间&gt;/chatbox/dialogues/&lt;文件名&gt;.json</code>。
  这些文件都可以通过<code>/reload</code>指令来重载，重载后，跳转到一句新的对话生效。</p>
<h1 id="数据包编写" data-toc-id="数据包编写">数据包编写</h1>
<p>你可以在本模组的jar包里面找到数据包案例参考学习。</p>
<div type="warning" data-type="admonition" data-admo-type="warning">
  <div data-type="admonition-title">WARNING</div>
  <div data-type="admonition-content">
    <p>需要注意的是，模组内置的数据文件并不是标准格式的数据包，如需复制出来修改，记得修改文件名！</p>
    <p>需要注意的是，模组内置的数据文件并不是标准格式的数据包，如需复制出来修改，记得加上pack.mcmeta文件！</p>
    <p>需要注意的是，模组内置的数据文件并不是标准格式的数据包，如需复制出来修改，记得修改文件名以及加上pack.mcmeta文件！</p>
  </div>
</div>
<p>首先你要创建一个数据包，具体去参考<a
    href="https://zh.minecraft.wiki/w/%E6%95%B0%E6%8D%AE%E5%8C%85"
    target="_blank"
    rel="noopener noreferrer nofollow">MCwiki</a>的数据包介绍。根据上方数据包路径介绍在对应的文件路径创建一个对话框文本的Json和对话框主题的Json。对话框主要由以下几种组件构成：对话框、选项、功能按钮、立绘。主题文件主要配置的是其材质，位置，大小等等，而文本文件主要配置的是文本，交互等等。
</p>
<p>
  接下来我会给你介绍2种数据包，在此之前你需要了解一下3种对字段的要求：必填（必须填写，不填写可能会导致游戏崩溃），建议填（不填写不会导致游戏崩溃，在特定的场合不填写也许能实现你的需求），可选（模组提供了默认值或者是扩展功能，你不填写也没问题）。
</p>
<h2 id="对话框主题" data-toc-id="对话框主题">对话框主题</h2>
<p>基础架构如下：</p><pre language="json" isclosed="false"><code class="language-json">{
  "portrait": {},
  "option": {},
  "dialogBox": {},
  "functionalButton": {},
  "keyPrompt": {},
  "customAnimation": {}
}</code></pre>
<h3 id="组件" data-toc-id="组件">组件</h3>
<p>
  什么是组件？你在本模组的对话框界面看到的所有内容都是组件，包括对话框，选项，历史聊天记录按钮，立绘等，它们都继承了组件的属性，因此有相同的基础参数类型（如位置、大小等）。组件的基础参数的作用完全相同，此处统一介绍后，之后的内容将只介绍不同组件特有的参数。
</p>
<p>组件的基础参数如下：</p>
<ul>
  <li>
    <p><code>x</code>:
      组件的横坐标，单位为相对于窗口宽度的百分比，0即窗口左侧，100即窗口右侧，超出这个范围就不会（完整）显示在窗口内。</p>
  </li>
  <li>
    <p><code>y</code>:
      组件的纵坐标，单位为相对于窗口高度的百分比，0即窗口顶部，100即窗口底部，超出这个范围就不会（完整）显示在窗口内。</p>
  </li>
  <li>
    <p><code>width</code>: 组件的宽度，单位为相对于窗口宽度的百分比，如填20，组件的宽度会显示为窗口宽度的20%。</p>
  </li>
  <li>
    <p><code>height</code>: 组件的高度，单位为相对于窗口高度的百分比，如填20，组件的高度会显示为窗口高度的20%。</p>
  </li>
  <li>
    <p><code>scale</code>: 组件的缩放比例，默认值为1。渲染时以组件的<strong>中心位置</strong>为基准进行缩放。
    </p>
  </li>
  <li>
    <p><code>alignX</code>:
      组件的水平对齐方式，默认值为<code>left</code>。可选值为<code>left，center，right</code>。</p>
  </li>
  <li>
    <p><code>alignY</code>:
      组件的垂直对齐方式，默认值为<code>top</code>。可选值为<code>top，center，bottom</code>。</p>
  </li>
  <li>
    <p><code>renderOrder</code>:
      组件的渲染顺序，值越大渲染在越上层。你可以把它理解为图层，该数值大的组件会渲染在该数值小的组件上层。不同组件的默认渲染顺序不同，这个后面会单独说明。
    </p>
  </li>
  <li>
    <p><code>brightness</code>:
      组件的亮度，默认值为<code>100</code>，单位为百分比。范围为0-100，为0时组件就是黑乎乎的。</p>
  </li>
  <li>
    <p><code>opacity</code>:
      组件的透明度，默认值为<code>100</code>，单位为百分比。范围为0-100，为0时组件完全透明，为100时组件完全不透明。</p>
  </li>
  <li>
    <p><code>angle</code>:
      组件的旋转角度，默认值为<code>0</code>，单位为角度。渲染时以组件的<strong>中心位置</strong>为基准顺时针旋转。</p>
  </li>
  <li>
    <p><code>hidden</code>: 组件是否隐藏，默认值为<code>false</code>。配合组件渲染事件使用，一般不用管。</p>
  </li>
  <li>
    <p><code>renderEvents</code>: 组件渲染事件，<strong>详见</strong><a
        href="?file=&quot;13-扩展功能.组件渲染事件.md&quot;">组件渲染事件</a>。</p>
    <div type="info" data-type="admonition" data-admo-type="info">
      <div data-type="admonition-title">INFO</div>
      <div data-type="admonition-content">
        <p>
          如果组件有额外渲染的文本，<code>scale, brightness, opacity, angle</code>这些参数也会影响到文本的渲染。
        </p>
      </div>
    </div>
  </li>
</ul>
<h3 id="立绘" data-toc-id="立绘">立绘</h3>
<p>这里的立绘是预设的状态，将在写对话文本的时候调用立绘的标识符来使用。立绘有3种类型，不同类型的立绘参数作用略有不同。话不多说，上案例：</p><pre language="json" isclosed="false"><code class="language-json">{
  "portrait": {
    "pic": {
      "type": "texture",
      "texture": "chatbox:textures/portrait/authors.png",
      "animation": "BOUNCE",
      "x": 0, "y": 0, "width": 10, "height": 10, "alignX": "left", "alignY": "bottom",
      "brightness": 100,
      "opacity": 100,
      "scale": 1,
      "renderOrder": 20,
      "angle": 0,
      "attachment": [
        {
          "type": "text",
          "value": "Ciallo～(∠·ω&lt; )⌒★",
          "x": 3, "y": 3
        }
      ]
    },
    "player": {
      "type": "player_head",
      "texture": "@s",
      "x": 0, "y": 0, "width": 10, "height": 10, "alignX": "left", "alignY": "bottom",
      "opacity": 100,
      "scale": 1,
      "renderOrder": 20,
      "angle": 0,
      "customAnimation": [
        {"time": 50, "x": 20, "easing": "EASE_OUT_SINE"},
        {"time": 50, "scale": 1.2, "opacity": 0, "easing": "EASE_OUT_SINE"}
      ]
    },
    "item": {
      "type": "item",
      "texture": "diamond",
      "hoverTexture": "coal",
      "itemCount": 64,
      "customItemData": 114514,
      "scale": 1,
      "x": 0, "y": 0, "alignX": "left", "alignY": "bottom",
      "opacity": 100,
      "renderOrder": 20,
      "angle": 0,
      "customAnimation": [
        {"time": 50},
        {"time": 50, "angle": 360}
      ]
    }
  }
}</code></pre>
<p>在上面的案例中包含了3种立绘里包含的所有的参数，接下来我们来一一介绍一下这些参数：</p>
<p>
  首先<code>pic player item</code>都是唯一的标识符，你也可以理解成是这个立绘的名称，这些标识符只能出现一次，但是取名可以随便取，用于在对话框文本中调用。
</p>
<ul>
  <li>
    <p>
      <code>type</code>（可选，默认值为<code>texture</code>）：立绘的类型，可选值有<code>texture, player_head, item</code>。<code>texture</code>表示使用资源包的图片，<code>player_head</code>表示使用玩家皮肤的头像，<code>item</code>表示使用物品纹理。
    </p>
  </li>
</ul>
<div type="important" data-type="admonition" data-admo-type="important">
  <div data-type="admonition-title">IMPORTANT</div>
  <div data-type="admonition-content">
    <p>
      对于玩家头像，因为玩家头像渲染的宽和高是必须一致的，所以会根据这里的设置的<code>width</code>和<code>height</code>共同计算后得到头像的边长，边长
      = width​ * 屏幕的宽+height * 屏幕的高（需要注意宽和高有默认值为10）。</p>
    <p>对于物品纹理类型，宽和高参数无效，实际渲染出来的宽和高都是16像素，但你可以通过修改<code>scale</code>参数调整大小。</p>
  </div>
</div>
<ul>
  <li>
    <p>
      <code>texture</code>（必填）：立绘的材质。如果是<code>texture</code>类型，需要填图片的路径；如果是<code>player_head</code>类型，需要填正版玩家的名字或者UUID或者用<code>@s</code>表示当前玩家；如果是<code>item</code>类型，需要填物品的id。
    </p>
  </li>
  <li>
    <p><code>hoverTexture</code>（可选）：鼠标悬停于立绘上时的材质，写法同上。</p>
  </li>
  <li>
    <p><code>attachment</code>（可选）：用于在立绘上附加一些额外的渲染，形成一个整体。<strong>详见</strong><a
        href="?file=&quot;11-扩展功能.渲染附件.md&quot;">渲染组件</a>。</p>
  </li>
  <li>
    <p><code>itemCount</code>（可选，默认值为1）：物品数量，仅对<code>item</code>类型立绘有效。</p>
  </li>
  <li>
    <p>
      <code>customItemData</code>（可选）：自定义物品模型数据（nbt键名<code>CustomModelData</code>），仅对<code>item</code>类型立绘有效，1.21.2+版本弃用。
    </p>
  </li>
  <li>
    <p><code>renderOrder</code>（可选）：立绘的渲染顺序默认为20。</p>
  </li>
  <li>
    <p>
      <code>animation</code>（可选）：预设动画，直接从主题文件中预设的动画里获取对应的动画并应用。模组内置了3种可以直接使用的动画：<code>FADE_IN</code>渐入效果，<code>SLIDE_IN_FROM_BOTTOM</code>从底部滑入，<code>BOUNCE</code>弹跳。你也可以自己在主题文件中预设新的动画，<strong>详见</strong><a
        href="?file=&quot;12-扩展功能.动画.md&quot;">动画</a>。</p>
  </li>
  <li>
    <p>
      <code>customAnimation</code>（可选）：自定义动画，采用的是关键帧动画的配置方式。<strong>详见</strong><a
        href="?file=&quot;12-扩展功能.动画.md&quot;">动画</a>。</p>
  </li>
  <li>
    <p><code>loop</code>（可选，默认值<code>false</code>）：是否循环播放动画。</p>
  </li>
</ul>
<div type="info" data-type="admonition" data-admo-type="info">
  <div data-type="admonition-title">INFO</div>
  <div data-type="admonition-content">
    <p>如果一个立绘同时填写了<code>animation</code> 和<code>customAnimation</code>
      字段，那么只有<code>customAnimation</code> 会生效。</p>
  </div>
</div>
<h3 id="选项" data-toc-id="选项">选项</h3><pre language="json" isclosed="false"><code class="language-json">{
  "option":{
    "texture": "chatbox:textures/options/default_no_checked_option.png",
    "hoverTexture": "chatbox:textures/options/default_checked_option.png",
    "lockTexture": "chatbox:textures/options/default_lock_checked_option.png",
    "optionChatX": 0, "optionChatY": 0, "textAlign": "left",
    "x": 0, "y": 0, "width": 10, "height": 10, "alignX": "left", "alignY": "bottom",
    "opacity": 100,
    "renderOrder": 10
  }
}</code></pre>
<ul>
  <li>
    <p><code>texture</code>（建议填）：选项默认贴图。</p>
  </li>
  <li>
    <p><code>hoverTexture</code>（建议填）：鼠标悬浮时的贴图。</p>
  </li>
  <li>
    <p><code>lockTexture</code>（建议填）：选项上锁时的贴图。</p>
  </li>
  <li>
    <p><code>optionChatX</code>（可选，默认0）：选项文本水平偏移。</p>
  </li>
  <li>
    <p><code>optionChatY</code>（可选，默认0）：选项文本垂直偏移。</p>
  </li>
  <li>
    <p>
      <code>textAlign</code>（可选，默认左对齐）：文本对齐，可选参数：<code>LEFT, CENTER, RIGHT</code>
      。</p>
  </li>
  <li>
    <p><code>renderOrder</code>（可选）：选项的渲染顺序默认为10。</p>
  </li>
</ul>
<h3 id="对话框" data-toc-id="对话框">对话框</h3><pre language="json" isclosed="false"><code class="language-json">{
  "dialogBox": {
    "texture": "chatbox:textures/chatbox/default_dialog_box.png",
    "lineWidth": 70,
    "nameX": 0, "nameY": 0, "textX": 0, "textY": 0, "textAlign": "left",
    "x": 0, "y": 0, "width": 10, "height": 10, "alignX": "left", "alignY": "bottom",
    "opacity": 100,
    "renderOrder": 0
  }
}</code></pre>
<ul>
  <li>
    <p><code>texture</code>（建议填）：对话框贴图。</p>
  </li>
  <li>
    <p><code>lineWidth</code>（必填）：一行文本的宽度，单位为mc窗口宽度的百分比。</p>
  </li>
  <li>
    <p><code>nameX</code>（可选，默认0）：名称距离左边框的水平位置。</p>
  </li>
  <li>
    <p><code>nameY</code>（可选，默认0）：名称距离贴图上边框的垂直位置。</p>
  </li>
  <li>
    <p><code>textX</code>（可选，默认0）：文本距离左边框的水平位置。</p>
  </li>
  <li>
    <p><code>textY</code>（可选，默认0）：文本距离贴图上边框的垂直位置。</p>
  </li>
  <li>
    <p>
      <code>textAlign</code>（可选，默认左对齐）：文本对齐，同时影响名称和文本的对齐方式，可选参数：<code>LEFT, CENTER, RIGHT</code>
      。</p>
  </li>
  <li>
    <p><code>renderOrder</code>（可选）：对话框的渲染顺序默认为0。</p>
  </li>
</ul>
<h3 id="功能按钮" data-toc-id="功能按钮">功能按钮</h3>
<div type="important" data-type="admonition" data-admo-type="important">
  <div data-type="admonition-title">IMPORTANT</div>
  <div data-type="admonition-content">
    <p>功能按钮的配置是一个数组，每个元素都是一个功能按钮的配置，如果你不写某个功能按钮的配置，那么该功能按钮就不会显示，按钮对应的功能也就无法使用。
    </p>
  </div>
</div><pre language="json" isclosed="false"><code class="language-json">{
  "functionalButton":[
    {
      "type": "LOG",
      "texture": "chatbox:textures/button/default_log.png",
      "hoverTexture": "chatbox:textures/button/default_hover_log.png",
      "x": 0, "y": 0, "width": 5, "height": 8, "alignX": "right", "alignY": "bottom",
      "opacity": 100, "renderOrder": 30
    },
    {
      "type": "FASTFORWARD",
      "texture": "chatbox:textures/button/default_fastforward.png",
      "hoverTexture": "chatbox:textures/button/default_hover_fastforward.png",
      "x": -5, "y": 0, "width": 5, "height": 8, "alignX": "right", "alignY": "bottom",
      "opacity": 100, "renderOrder": 30
    },
    {
      "type": "AUTOPLAY",
      "texture": "chatbox:textures/button/default_autoplay.png",
      "hoverTexture": "chatbox:textures/button/default_hover_autoplay.png",
      "x": -10, "y": 0, "width": 5, "height": 8, "alignX": "right", "alignY": "bottom",
      "opacity": 100, "renderOrder": 30
    }
  ]
}</code></pre>
<ul>
  <li>
    <p>
      <code>type</code>（必填）按钮的类型，目前支持<code>LOG</code>历史记录按钮，<code>FASTFORWARD</code>快进按钮，<code>AUTOPLAY</code>自动播放按钮。
    </p>
  </li>
  <li>
    <p><code>texture</code>（建议填）：贴图。</p>
  </li>
  <li>
    <p><code>hoverTexture</code>（建议填）：鼠标悬浮时或功能激活时的贴图。</p>
  </li>
  <li>
    <p><code>renderOrder</code>（可选）：功能按钮的渲染顺序默认为30。</p>
  </li>
</ul>
<div type="info" data-type="admonition" data-admo-type="info">
  <div data-type="admonition-title">INFO</div>
  <div data-type="admonition-content">
    <p>
      自动播放的机制：如果一句对话设置了语音（<code>sound</code>定义的音效，<code>command</code>指令播放音效不算），则会在语音播放完一秒后进入下一句话；如果没有设置声音，则会在文本全部展示后的一秒后（默认值，可通过对话文件的字段<code>autoPlayTick</code>修改）进入下一句话。
    </p>
  </div>
</div>
<h3 id="按键提示" data-toc-id="按键提示">按键提示</h3>
<div type="important" data-type="admonition" data-admo-type="important">
  <div data-type="admonition-title">IMPORTANT</div>
  <div data-type="admonition-content">
    <p>该功能只会在非屏幕主题对话框时才会有用。</p>
  </div>
</div><pre language="json" isclosed="false"><code class="language-json">{
  "keyPrompt": {
    "visible": true,
    "mouseTextureWidth": 16, "mouseTextureHeight": 16,
    "rightClickTexture": "chatbox:textures/key/right_mouse.png",
    "scrollTexture": "chatbox:textures/key/scroll_mouse.png",
    "x": 0, "y": 0, "alignX": "left", "alignY": "bottom", "renderOrder": 40
  }
}</code></pre>
<ul>
  <li>
    <p>
      <code>visible</code>（可选，默认<code>true</code>）：是否显示按键提示。如果不显示，玩家将无法直接跳转下一句对话（选项仍然可选）。
    </p>
  </li>
  <li>
    <p><code>mouseTextureWidth</code>（可选，默认16）：鼠标材质的宽度，单位像素。</p>
  </li>
  <li>
    <p><code>mouseTextureHeight</code>（可选，默认16）：鼠标材质的高度，单位像素。</p>
  </li>
  <li>
    <p><code>rightClickTexture</code>（可选）：右键鼠标材质。</p>
  </li>
  <li>
    <p><code>scrollTexture</code>（可选）：滚轮鼠标材质。</p>
  </li>
  <li>
    <p><code>renderOrder</code>（可选）：按键提示的渲染顺序默认为40。</p>
  </li>
</ul>
<h4 id="mod资源包自带的贴图" data-toc-id="mod资源包自带的贴图">mod资源包自带的贴图</h4>
<p>本模组自带了一些有关于对话框的贴图，如果觉得自己做一套对话框的贴图比较麻烦的话，可以来使用本模组自带的贴图。</p>
<blockquote>
  <p>对话框材质：</p>
  <p>chatbox:textures/chatbox/default_dialog_box.png</p>
  <p>chatbox:textures/chatbox/gal_dialog_box.png</p>
  <p>选项材质：</p>
  <p>chatbox:textures/options/default_checked_option.png</p>
  <p>chatbox:textures/options/default_lock_checked_option.png</p>
  <p>chatbox:textures/options/default_no_checked_option.png</p>
  <p>chatbox:textures/options/gal_checked_option.png</p>
  <p>chatbox:textures/options/gal_no_checked_option.png</p>
  <p>功能按钮：</p>
  <p>chatbox:textures/button/default_log.png</p>
  <p>chatbox:textures/button/default_hover_log.png</p>
  <p>chatbox:textures/button/default_fastforward.png</p>
  <p>chatbox:textures/button/default_hover_fastforward.png</p>
  <p>chatbox:textures/button/default_autoplay.png</p>
  <p>chatbox:textures/button/default_hover_autoplay.png</p>
</blockquote>
<h4 id="部分参数细解" data-toc-id="部分参数细解">部分参数细解</h4>
<p>Q：<code>renderOrder</code>这个参数到底有什么用？</p>
<p>
  A：这个参数是决定这个组件在页面上渲染的顺序的，因为你在实际使用其它一些模组的对话框的时候可能会遇到这种问题：我无法将人物立绘显示在对话框和选项的下面，这可能是因为这些模组是锁死的渲染的顺序，先渲染的对话框和选项，再渲染的人物立绘，此时这个人物立绘就必定在上面一层了。而<code>renderOrder</code>就是为了解决这个问题的，默认情况下对话框为0，选项为10，立绘为20，历史聊天记录按钮为30。
</p>
<p>下面这张图能明显看到立绘的<code>renderOrder</code>为0和-1时的区别，这就是这个参数的作用：</p><img
  src="https://github.com/zhenshiz/picx-images-hosting/raw/master/1.et03f5o6r.gif">
<p>
  右键隐藏对话框时，也会自动将在对话框之上的立绘隐藏，也就是将所有立绘<code>renderOrder</code>比对话框<code>renderOrder</code>值大的隐藏，模组内部将这个视作区分是背景用立绘和对话框用立绘的区别。
</p>
<p></p>
<p>Q：部分参数的枚举字符串可以是小写吗？</p>
<p>A：所有的枚举字符串参数都是无视大小写的，你可以任意选择都可以被识别。</p>
<h2 id="对话文本" data-toc-id="对话文本">对话文本</h2>
<p>在介绍对话文件的架构前，先介绍一下我对对话部分的架构设计，这将有利于你理解为什么要这么写这个文件。我的对话架构总结一下就是这么一张图：</p><img
  src="https://github.com/zhenshiz/picx-images-hosting/raw/master/5bc82faf-25d1-482d-bcf0-95561db0e1ea.491qlho57b.webp">
<p>
  将所有的对话分模块分组，每个模块都有一个唯一的标识，这也是为什么我进入一个对话，需要一个组名和一个数字的序号。这个架构的好处是可以很好的支持多分支的剧本，不会使大量对话堆在一起而乱套了。
</p>
<p>接下来我们展示对话文件的基础框架：</p><pre language="json" isclosed="false"><code class="language-json">{
  "$introduce": "这是一段介绍本模组的文本",
  "dialogues": {
    "start":[{}, {}, {}],
    "branch1":[{}],
    "branch2":[{}, {}]
  },
  "isEsc": true,
  "isPause": true,
  "isHistoricalSkip": true,
  "maxTriggerCount": -1,
  "isScreen": true,
  "theme": "",
  "criteria": {},
  "animationFPS": 60,
  "autoPlayTick": 20
}</code></pre>
<div type="info" data-type="admonition" data-admo-type="info">
  <div data-type="admonition-title">INFO</div>
  <div data-type="admonition-content">
    <p>所有文本都是翻译键，若你懒得写翻译键，也可以直接写文本，都无所谓。</p>
  </div>
</div>
<ul>
  <li>
    <p>
      <code>$introduce</code>（可选）：纯装饰作用，不写也可以，我这里写是提供一个建议，给整个文件一个大致的主题防止开发者迷路找不到自己写的文本，比如主线，支线1，支线2等等标识。
    </p>
  </li>
  <li>
    <p>
      <code>dialogues</code>（必填）：包含该文件中所有的对话文本，这里的<code>start, branch1, branch2</code>是分组的唯一标识，在这里面可以编写分组的多段对话。
    </p>
  </li>
  <li>
    <p>
      <code>animationFPS</code>（可选，默认60）：对话中立绘动画的帧率，默认60帧/秒。一般情况下MC的帧率并不稳定，若不限制动画帧率，不同设备看到的动画效果就不一样，也难以计时。若你的设备性能较低（不能稳定60帧以上），动画会以游戏实际帧率播放。
    </p>
  </li>
  <li>
    <p><code>autoPlayTick</code>（可选，默认20）：自动播放下一句话的延迟时间，单位为游戏刻（1秒=20游戏刻）。</p>
  </li>
  <li>
    <p><code>isEsc</code>（可选，默认<code>true</code>）：玩家是否可以通过Esc关闭对话框。</p>
  </li>
  <li>
    <p><code>isPause</code>（可选，默认<code>true</code>）：玩家在单人游戏打开对话框是否暂停游戏。</p>
  </li>
  <li>
    <p><code>isHistoricalSkip</code>（可选，默认<code>true</code>）：历史记录界面是否可以回溯对话。</p>
  </li>
  <li>
    <p><code>maxTriggerCount</code>（可选，默认-1）：这段对话可被触发的次数，默认为无限触发。</p>
  </li>
  <li>
    <p>
      <code>isScreen</code>（可选，默认<code>true</code>）：是否启用屏幕主题，<code>false</code>为render（渲染层）模式。
    </p>
  </li>
  <li>
    <p><code>theme</code>（可选）：进入对话时会自动设置为这个主题。</p>
  </li>
  <li>
    <p><code>criteria</code>（可选）：提供一个自定义的进度触发器，写法和原版进度一模一样，具体可以参考<a
        href="https://zh.minecraft.wiki/w/%E8%BF%9B%E5%BA%A6%E5%AE%9A%E4%B9%89%E6%A0%BC%E5%BC%8F"
        target="_blank" rel="noopener noreferrer nofollow">MCwiki</a>，你也可以利用<a
        href="https://misode.github.io/advancement/" target="_blank"
        rel="noopener noreferrer nofollow">进度生成器</a>来生成<code>criteria</code>。
    </p>
  </li>
</ul>
<p>接下来我们来介绍一下一句对话里都有哪些参数：</p><pre language="json" isclosed="false"><code class="language-json">{
  "renderEvents": [
    {"trigger": "start", "type": "hide", "value": ""}
  ],
  "dialogBox": {
    "name": "chatbox.test.name.1",
    "text": "chatbox.test.text.1"
  },
  "portrait": [
    "authors",
    {
      "id": "authors",
      "replace": false,
      "customAnimation": [
        {"time": 360, "angle": -360, "scale": 2}
      ]
    }
  ],
  "options": [
    {
      "text": "对目标造成10点伤害",
      "tooltip": "需要物品栏第一格是下界合金剑",
      "isLock": true,
      "unlockCommand": "execute if entity @s[nbt={Inventory:[{id:\"minecraft:netherite_sword\",Slot:0b}]}]",
      "click": {
        "type": "command",
        "value": "damage &lt;target1.uuid&gt; 10 minecraft:generic by @s from @s; give @s minecraft:diamond"
      },
      "next": "this"
    },
    {
      "text": "测试隐藏",
      "isLock": false,
      "unlockCommand": "execute if entity @s[nbt={Inventory:[{id:\"minecraft:diamond\"}]}]",
      "click": {
        "type": "command",
        "value": "say 我有钻石了"
      },
      "next": "this"
    },
    {
      "text": "退出",
      "next": "-1"
    }
  ],
  "video": {
    "path": "",
    "canControl": false,
    "canSkip": true,
    "loop": false,
    "renderEvents": []
  },
  "sound": "minecraft:ambient.cave",
  "command": "say 你好; give @s minecraft:iron_ingot",
  "backgroundImage": "",
  "clearOldPortrait": true,
  "removePortrait": []
}</code></pre>
<p>这段包含了一段文本里的所有参数，接下来我们一点一点来介绍吧：</p>
<ul>
  <li>
    <p><code>renderEvents</code>：与组件的<a
        href="?file=&quot;13-扩展功能.组件渲染事件.md&quot;">渲染事件</a>写法相同，但是仅会在进入这句对话时触发（即只有<code>on_start</code>时机的事件有效）。
    </p>
  </li>
  <li>
    <p><code>sound</code>（可选）：音乐的路径比如<code>minecraft:ambient.cave</code> 。</p>
  </li>
  <li>
    <p><code>command</code>（可选）：执行指令，支持多段指令，用<code>;</code>分隔，指令权限为2级。</p>
  </li>
  <li>
    <p><code>backgroundImage</code>（可选）：背景图片。</p>
  </li>
</ul>
<div type="important" data-type="admonition" data-admo-type="important">
  <div data-type="admonition-title">IMPORTANT</div>
  <div data-type="admonition-content">
    <p><code>backgroundImage</code>的图片没有任何额外参数，如果你想要背景有动画，还是需要把背景做成立绘。</p>
  </div>
</div>
<h3 id="对话框" data-toc-id="对话框">对话框</h3>
<ul>
  <li>
    <p><code>name</code>（可选）：名称</p>
  </li>
  <li>
    <p><code>text</code>（可选）：对话文本</p>
  </li>
</ul>
<h3 id="立绘以及立绘控制系统" data-toc-id="立绘以及立绘控制系统">立绘以及立绘控制系统</h3>
<ul>
  <li>
    <p>
      <code>portrait</code>（可选）：这里可以填字符串或者json。如果是字符串填的就是我们在主题文件中预设的立绘标识符了；如果是json，则是用于在主题预设的立绘上覆盖部分信息，可以避免就修改一点点信息就要在主题文件里预设新的立绘，让我们的配置更加自由。
    </p>
  </li>
</ul>
<div type="info" data-type="admonition" data-admo-type="info">
  <div data-type="admonition-title">INFO</div>
  <div data-type="admonition-content">
    <p>覆盖立绘的json有两个额外的参数：<code>id</code>即你想要基于它进行修改的立绘标识符；<code>replace</code>
      若为<code>true</code>，则会移除当前已有的所有同名立绘。</p>
  </div>
</div>
<ul>
  <li>
    <p><code>clearOldPortrait</code>（可选，默认为<code>true</code>）：是否清除上一句对话的立绘。</p>
  </li>
  <li>
    <p>
      <code>removePortrait</code>（可选）：如果不清除上一句对话的立绘，可以手动填写想要移除的立绘，填立绘的标识符，所有同名的立绘都会被移除。
    </p>
    <div type="info" data-type="admonition" data-admo-type="info">
      <div data-type="admonition-title">INFO</div>
      <div data-type="admonition-content">
        <p>
          这两个参数的使用场景：有时候我希望多句连续的对话使用同样的立绘，此时每句对话都在portrait填同样的参数，有点麻烦，把clearOldPortrait设为false就好了。并且如果你的立绘有较长时间的动画（特别是背景需要缓慢移动），如果在portrait填同样的参数，就会导致动画也重新播放。而removePortrait也很简单，如果clearOldPortrait为false，这句对话就会继承上一句对话的所有立绘，若此时我想要更换某一个特定的立绘，就可以在这里填写需要更换的立绘标识，然后再在portrait填新的立绘即可。
        </p>
      </div>
    </div>
  </li>
</ul>
<h3 id="选项" data-toc-id="选项">选项</h3>
<ul>
  <li>
    <p><code>text</code>（必填）：选项文本。</p>
  </li>
  <li>
    <p>
      <code>isLock</code>（可选，默认<code>false</code>）：是否上锁，配合<code>unlockCommand</code>使用。若没有定义<code>unlockCommand</code>，则这个选项永远都会被锁定。
    </p>
  </li>
  <li>
    <p>
      <code>unlockCommand</code>（可选）：用于判断选项是否会有特殊状态的指令，必须以<code>execute</code>开头才会有效。若该指令测试通过，则选项是正常可选状态，否则选项会被上锁（<code>isLock</code>为<code>true</code>）或隐藏（<code>isLock</code>为<code>false</code>或未定义）。
    </p>
  </li>
</ul>
<div type="important" data-type="admonition" data-admo-type="important">
  <div data-type="admonition-title">关于选项的隐藏</div>
  <div data-type="admonition-content">
    <p>选项通过自己的<code>hidden</code>字段隐藏和因为<code>unlockCommand</code>
      测试不通过而隐藏的机制是不一样的。前者只是客户端渲染层面上的隐藏，可以通过组件渲染事件恢复；后者是服务端隐藏，比较彻底，无法通过组件渲染事件恢复。
    </p>
  </div>
</div>
<ul>
  <li>
    <p>
      <code>next</code>（可选）：如果填的为数字则跳转到当前分组对应数字序号的对话，如果填的是字符串则跳转到对应分组的第一句话，如果不填则默认跳转到当前分组当前对话的下一句话，<strong>填</strong><code>this</code><strong>会留在当前对话，填负数则会直接结束对话。</strong>
    </p>
  </li>
  <li>
    <p>
      <code>click</code>（可选）：点击按钮触发的事件，里面有2个参数<code>type</code>和<code>value</code>。如果要用的话基本上<code>type</code>都填<code>command</code>，<code>value</code>则是要执行的指令，支持多段指令，用<code>;</code>分隔，指令权限为2级。更多<code>type</code><strong>详见</strong><a
        href="?file=&quot;13-扩展功能.组件渲染事件.md&quot;"><strong>组件渲染事件</strong></a>。
    </p>
  </li>
  <li>
    <p><code>tooltip</code>（可选）：鼠标悬浮时显示的文本。</p>
  </li>
</ul>
<h3 id="视频" data-toc-id="视频">视频</h3>
<div type="important" data-type="admonition" data-admo-type="important">
  <div data-type="admonition-title">IMPORTANT</div>
  <div data-type="admonition-content">
    <p>本功能需要安装<a href="https://modrinth.com/mod/watermedia" target="_blank"
        rel="noopener noreferrer nofollow">WATERMeDIA</a>模组才能生效！开发环境使用的版本是2.1.25，<strong>请勿使用3.x版本的watermedia！</strong>
    </p>
  </div>
</div>
<ul>
  <li>
    <p>
      <code>path</code>（可选）：播放视频的路径，可以是绝对路径，也可以是从当前游戏版本根目录(<code>saves、resourcepacks</code>所在的文件夹)开始的相对路径，推荐使用相对路径，<strong>并且游戏安装目录的完整路径不能包含中文字符！</strong>
    </p>
  </li>
  <li>
    <p>
      <code>canControl</code>（可选，默认<code>true</code>）：是否允许调整视频的进度，左右方向键调节播放进度，按空格暂停。
    </p>
  </li>
</ul>
<div type="info" data-type="admonition" data-admo-type="info">
  <div data-type="admonition-title">INFO</div>
  <div data-type="admonition-content">
    <p>视频音量无论如何都是可以调整的：用上下方向键调节音量大小，M键静音。</p>
  </div>
</div>
<ul>
  <li>
    <p><code>canSkip</code>（可选，默认<code>true</code>）：是否允许玩家跳过这段视频。</p>
  </li>
  <li>
    <p><code>loop</code>（可选，默认<code>false</code>）：是否循环播放视频。</p>
  </li>
  <li>
    <p>
      <code>x</code>（可选，默认为0）、<code>y</code>（可选，默认为0）、<code>width</code>（可选，默认100）、<code>height</code>（可选，默认100）、<code>alignX</code>（可选，默认左对齐）、<code>alignY</code>（可选，默认上对齐）：效果同组件的对应参数，此处不赘述。
    </p>
  </li>
</ul>
<h1 id="配置文件" data-toc-id="配置文件">配置文件</h1>
<p>你可以通过NeoForge自带的可视化界面中修改配置项，目前提供的配置项包括：</p>
<ul>
  <li>
    <p>历史记录界面滚轮速度</p>
  </li>
  <li>
    <p>下句话如果没有新音效，是否中断前面正在播放的音效</p>
  </li>
  <li>
    <p>对话框每秒显示的字符数</p>
  </li>
  <li>
    <p>是否阻拦泰拉生物NPC的对话系统（需要安装泰拉生物模组）</p>
  </li>
</ul>
<h1 id="隐藏按键小技巧" data-toc-id="隐藏按键小技巧">隐藏按键小技巧</h1>
<p>在本模组的屏幕模式下，还隐藏了很多参考Gal的便捷快捷键，但是由于设计问题没法很好的在游戏中提示用户这些按键，所以在这里将这些按键全部列举出来。</p>
<table style="min-width: 75px;">
  <colgroup>
    <col style="min-width: 25px;">
    <col style="min-width: 25px;">
    <col style="min-width: 25px;">
  </colgroup>
  <tbody>
    <tr>
      <th colspan="1" rowspan="1">
        <p>界面</p>
      </th>
      <th colspan="1" rowspan="1">
        <p>按键</p>
      </th>
      <th colspan="1" rowspan="1">
        <p>功能</p>
      </th>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">
        <p>对话框界面</p>
      </td>
      <td colspan="1" rowspan="1">
        <p>Ctrl（mac为Cmd）</p>
      </td>
      <td colspan="1" rowspan="1">
        <p>快进对话（如果可以快进）</p>
      </td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">
        <p>对话框界面</p>
      </td>
      <td colspan="1" rowspan="1">
        <p>滚轮向下</p>
      </td>
      <td colspan="1" rowspan="1">
        <p>效果同鼠标左键点击</p>
      </td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">
        <p>对话框界面</p>
      </td>
      <td colspan="1" rowspan="1">
        <p>滚轮向上</p>
      </td>
      <td colspan="1" rowspan="1">
        <p>打开历史记录界面</p>
      </td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">
        <p>对话框界面</p>
      </td>
      <td colspan="1" rowspan="1">
        <p>右键</p>
      </td>
      <td colspan="1" rowspan="1">
        <p>隐藏/展示对话框</p>
      </td>
    </tr>
    <tr>
      <td colspan="1" rowspan="1">
        <p>历史记录界面</p>
      </td>
      <td colspan="1" rowspan="1">
        <p>右键</p>
      </td>
      <td colspan="1" rowspan="1">
        <p>关闭历史记录界面，返回当前对话</p>
      </td>
    </tr>
  </tbody>
</table>
<div type="info" data-type="admonition" data-admo-type="info">
  <div data-type="admonition-title">INFO</div>
  <div data-type="admonition-content">
    <p>右键隐藏的包括对话框、选项、渲染于对话框之上的立绘、功能按钮。</p>
  </div>
</div>
<p>此外，在对话框界面中，按下F3键可以打开调试<span data-type="hidden-text">（戏）</span>模式。</p>
<h1 id="你知道吗" data-toc-id="你知道吗">你知道吗</h1>
<ol>
  <li>
    <p>对话框、选项和功能按钮组件本质都是立绘，不过是有一些额外的参数而已。因此这些组件是可以有动画和附件的。</p>
  </li>
  <li>
    <p>
      选项和对话框的文本渲染其实是借用了附件的渲染，这更加说明了它们就是立绘。<span data-type="hidden-text">（1.1版本后才是的）</span>
    </p>
  </li>
  <li>
    <p>
      如果你觉得这篇文档内容很多或很复杂<span data-type="hidden-text">（特别是立绘附件、动画、组件渲染事件这些）</span>，你可以把文档全部丢给AI，让AI帮你生成对话json。但是AI不能完全理解文档的全部内容，还需结合文档和实际效果修改。
    </p>
  </li>
</ol>
<h1 id="未来可能更新的功能" data-toc-id="未来可能更新的功能">未来可能更新的功能</h1>
<ol>
  <li>
    <p>联动一个npc模组（作者正在开发中）</p>
  </li>
</ol>
<p></p>