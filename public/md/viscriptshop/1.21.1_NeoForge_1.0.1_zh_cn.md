# 模组介绍

ViScriptShop 是一款商店模组，它允许创建一个带有灵活交易系统的自定义游戏内商店。该模组支持传统的基于货币的交易方式以及以物易物式的物品交换，并采用阶段性进度系统，对商品的出售进行限制。商店界面采用更加现代化的购物车式购买，将购买的商品和所需的货币全部展示出来。

# 指令

/viscript\_shop editor 商店id(可选)  打开可视化编辑器

/viscript\_shop open 商店id 商店名(可选)  打开一个商店

/viscript\_shop reload 商店id(可选)  从磁盘重新加载商店数据，清除缓存，主要用于创作阶段调试用，比如当你打开商店时，商店的信息缓存起来，你就算在编辑器里修改商店文件也不行，只有用这个指令才能清除缓存让你重新读取新的商店信息。商店id不填表示全部缓存都清除。

/viscript\_shop setStage 商店id 阶段值(int)  设置商店的阶段值

/viscript\_shop money add 玩家 钱(int)  给玩家钱

/viscript\_shop money remove 玩家 钱(int) 扣玩家钱，最多给玩家扣到0

/viscript\_shop money get 玩家 获取玩家的钱

/viscript\_shop money pay 玩家1 玩家2 钱(int) 转账，将玩家1的钱给玩家2，最多给玩家1扣到0，将扣除的钱给玩家2

**PS：商店id只读取服务端的文件**

# 编辑器教程

在使用编辑器前，你需要了解该编辑器运行的基础逻辑。该编辑器是类似于Unity的设计，包括项目文件和结果文件。项目文件是给编辑器使用的，他会存储编辑器上的信息，方便你再次打开以及基于该模板进行编辑；而结果文件是我们实际的使用时用到的文件，比如该模组的用处就是提供商店UI所需要的信息，玩家就可以用这个结果文件来打开商店UI。为了考虑多个玩家一起编辑以及同步文件，模组在打开商店只读取服务端的结果文件，你需要在编辑器中当当前文件上传到服务端才行。

现在你应该对编辑器中所有会出现的文件有一个简单的认知了，那么接下来我们来学习一下如何创造一个简单的商店。

1.首先我们进入游戏通过`/viscript_shop editor`指令来打开编辑器，此时我们就看到这个编辑器的界面了（见图1-1）。

[![1766068292569-75d4b4fc-8fcc-4c0a-9245-34a3d9cb1a6c](https://github.com/zhenshiz/picx-images-hosting/raw/master/7fe43c43a1b89783bb71a8849a406ce3.5j4nrono4x.webp "1766068292569-75d4b4fc-8fcc-4c0a-9245-34a3d9cb1a6c")](https://github.com/zhenshiz/picx-images-hosting/raw/master/7fe43c43a1b89783bb71a8849a406ce3.5j4nrono4x.webp)                                                                                                                                      (图1-1)

2.编辑器由以下部分组成：左上角工具栏，包括file和view，file中的功能包括创建一个商品的项目文件，打开项目文件，保存和另存为项目文件（只有打开项目文件时才会出现），另存和上传结果文件（只有打开项目文件时才会出现），设置，退出编辑器。view用于调整界面尺寸，把编辑器的大小调整到适合你屏幕编辑的大小；右上角包括最小化，向下还原(最大化)，关闭编辑器。这3个按钮和浏览器的是一样的，我就介绍一下最小化的按钮，最小化可以关闭编辑器，但是会将你当前的编辑器窗口保留着，当你再次打开这个编辑器的时候会全部重新显示出来，就不需要每次打开编辑器都重新打开项目文件了；下方3个模块分别是商店分类，分类里的商品信息以及商店的编辑器（见图2-1）。

![1766068330154-f7a47a3f-f335-4b4a-84e0-c249a76a8060](https://github.com/zhenshiz/picx-images-hosting/raw/master/8d8d76686229d3bcae489295d00327b3.2ksdo6fp5z.webp "1766068330154-f7a47a3f-f335-4b4a-84e0-c249a76a8060")                                                                                                                                        (图2-1)

3.我们先创建一个项目，此时最左侧的界面就有一个`+`的按钮了（见图3-1），点击添加分类，你可以在弹窗中修改分类的信息。此时我们再点击分类名这块（见图3-2），此时我们就会将该分类下的商品渲染到中间这个界面里，在这个界面里，我们可以通过上面这一栏的按钮中添加商品，以及按照商品的阶段值进行排序商品。我们可以通过右键商品弹出弹窗来选择编辑和删除商品（见图3-3）。右侧的编辑器包括商店的所有信息的可视化编辑，一般情况下左侧2个界面已经够用了，但是难免会遇到一些需要右侧编辑器的情况，比如修改商品的顺序（编辑器的列表可以拖拽修改位置）。当然你怕这个太占位置界面右上角的按钮也可以隐藏掉这个界面。最后一个要介绍的是和右侧编辑器并列的还有一个历史记录界面，这个界面会记录玩家对编辑器操作的记录，可以通过点击回到之前的某次编辑，主要用于撤回自己的一些操作用的。
4.在我们编辑完商品的信息后，就可以保存项目文件和结果文件了，项目文件的后缀名是.shopproj，结果文件的后缀名是.shop，你需要将你的结果文件上传到服务端，并填写一个文件名(见图3-4)，至此你就彻底做出了一个商店了。通过指令`/viscript_shop open 商店id`就可以打开商店了

![1766068997037-7d3cf670-fa4f-4ba3-b1eb-7a855dd54623](https://github.com/zhenshiz/picx-images-hosting/raw/master/f9bc5d78fa9effc5b2485edf8363469a.5q7vn4a8na.webp "1766068997037-7d3cf670-fa4f-4ba3-b1eb-7a855dd54623")                                                                                                                            （图3-1）

![1766069026438-fb9e298e-aa34-4561-be3a-9d17b5b56682](https://github.com/zhenshiz/picx-images-hosting/raw/master/e2f8a9c4-fa33-4152-b990-0e9dfc8b1907.3d595wwfgl.webp "1766069026438-fb9e298e-aa34-4561-be3a-9d17b5b56682")                                                                                                                              （图3-2）

![1766069055588-d7e229cd-84df-4368-af77-4fdd9b942e7d](https://github.com/zhenshiz/picx-images-hosting/raw/master/44933be6fe6309b3c44d9eb42621eedc.9gx18cz3us.webp "1766069055588-d7e229cd-84df-4368-af77-4fdd9b942e7d")                                                                                                                              （图片3-3）

![1767103525006-3233ad7e-8b4b-4ec4-8194-743ec4b33706](https://github.com/zhenshiz/picx-images-hosting/raw/master/5f39e18d-71f6-4382-b377-8498811c9ddb.4g4yxx596u.webp "1767103525006-3233ad7e-8b4b-4ec4-8194-743ec4b33706")                                                                                                                                    (图片3-4)

# 模组联动

## KubeJS

模组添加了更多的事件，用于玩家对本模组进行更好的自定义操作

```javascript
//client_script

//商店打开事件
ViScriptShopEvents.opening(event=>{})

//商店关闭事件
ViScriptShopEvents.closing(event=>{})

//商店tick事件
ViScriptShopEvents.tick(event=>{})

//server_script

//购买前的事件，可取消
ViScriptShopEvents.buyPre(event=>{
  event.cancel()
})

//购买失败的事件
ViScriptShopEvents.buyFail(event=>{})

//购买成功的事件
ViScriptShopEvents.buySuccess(event=>{})
```

除此之外客户端和服务端都有ViScriptShopUtil，可以调用对应的api来简化操作，详细参考ProbeJS或者GitHub：[服务端代码](https://github.com/zhenshiz/ViScriptShop/blob/master/src/main/java/com/viscriptshop/util/ViScriptShopServerUtil.java)和[客户端代码](https://github.com/zhenshiz/ViScriptShop/blob/master/src/main/java/com/viscriptshop/util/ViScriptShopClientUtil.java)

## 精妙背包

模组可以读取玩家背包中所有的精妙背包里的物品用于商店界面的交易

## 超越维度

模组可以读取与玩家绑定的维度背包里的物品用于商店界面的交易

## JEI

模组可以让你在商店界面对着物品点击对应绑定的按键来查看该物品的配方
